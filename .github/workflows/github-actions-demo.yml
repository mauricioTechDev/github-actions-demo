name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
      git_ref:
        required: true
        type: string
      AWS_REGION:
        required: true
        type: string
        
jobs:
  cancel-previous-runs:
    runs-on: ubuntu-latest
    steps:
      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.11.0
        with:
          access_token: ${{ github.token }}
        
  start-deployment:
    runs-on: ubuntu-latest
    needs: cancel-previous-runs
    steps:
      - name: Create Stage Release
        if: inputs.environment == 'staging' && success()
        uses: ./.github/workflows/cd-depoy.yml
        with:
          environment: ${{ inputs.environment }}
          TAG_NAME: ${{ inputs.git_ref }}
      - name: Create Production Release
        if: inputs.environment == 'prod' && success()
        uses: ./.github/workflows/cd-depoy.yml
        with:
          environment: ${{ inputs.environment }}
          git_ref: ${{ inputs.git_ref }}
          
